name: Notify on Push & Issues
run-name: "Notification Triggered by ${{ github.actor }}"

on:
  push:
    branches:
      - github-issues
  issues:
    types:
      - opened

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      # Handle Push Notification
      - name: Discord Commit Notification
        if: github.event_name == 'push'
        uses: Sniddl/discord-commits@v1.6
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          template: "avatar-with-link"
          include-extras: true

      - name: Send Telegram Message on Push
        if: github.event_name == 'push'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_TOPIC_ID: ${{ secrets.TELEGRAM_UPDATES }}
          GITHUB_COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          GITHUB_COMMIT_AUTHOR: ${{ github.event.head_commit.author.name }}
          GITHUB_COMMIT_URL: ${{ github.event.head_commit.url }}
        run: |
          curl -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
          -d chat_id="${TELEGRAM_CHAT_ID}" \
          -d message_thread_id="${TELEGRAM_TOPIC_ID}" \
          -d text="üöÄ *New Commit Pushed to Main!*
          üìù *Message:* ${GITHUB_COMMIT_MESSAGE}
          üßë‚Äçüíª *Author:* ${GITHUB_COMMIT_AUTHOR}
          üîó [View Commit](${GITHUB_COMMIT_URL})" \
          -d parse_mode="Markdown"

      # Handle Issue Notification
      - name: Discord Issue Notification
        if: github.event_name == 'issues'
        uses: Sniddl/discord-commits@v1.6
        with:
          webhook: ${{ secrets.DISCORD_ISSUES_URL }}
          template: "avatar-with-link"
          include-extras: true
          username: "GitHub Issues"
          message: "üêõ New Issue Created: **${{ github.event.issue.title }}**\nBy: ${{ github.event.issue.user.login }}\n[View Issue](${{ github.event.issue.html_url }})"

      - name: Send Telegram Message on Issue Creation
        if: github.event_name == 'issues'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_TOPIC_ID: ${{ secrets.TELEGRAM_ISSUES }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_AUTHOR: ${{ github.event.issue.user.login }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
        run: |
          curl -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
          -d chat_id="${TELEGRAM_CHAT_ID}" \
          -d message_thread_id="${TELEGRAM_TOPIC_ID}" \
          -d text="üêõ *New GitHub Issue Created!*
          üìù *Title:* ${ISSUE_TITLE}
          üßë‚Äçüíª *Author:* ${ISSUE_AUTHOR}
          üîó [View Issue](${ISSUE_URL})" \
          -d parse_mode="Markdown"
